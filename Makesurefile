
@goal default
@depends_on installed_bwk
@depends_on installed_gawk51

@goal soft_folder_created @private
@reached_if [[ -d "soft" ]]
  mkdir soft

@goal installed_bwk
@reached_if [[ -f soft/bwk ]]
@depends_on soft_folder_created
  echo
  echo "Fetching BWK..."
  echo

  cd "soft"

  wget https://github.com/onetrueawk/awk/archive/refs/heads/master.tar.gz -Obwk.tar.gz
  tar xzvf bwk.tar.gz
  rm bwk.tar.gz

  echo
  echo "Compile BWK..."
  echo

  cd "awk-master"

  make

  mv a.out ../bwk

  cd ..
  ./bwk --version
  rm -r awk-master

@goal installed_gawk51
@reached_if [[ -f soft/gawk51 ]]
@depends_on soft_folder_created
  echo
  echo "Fetching Gawk-5.1.0..."
  echo

  cd "soft"

  G=gawk-5.1.0.tar.gz
  wget "http://git.savannah.gnu.org/cgit/gawk.git/snapshot/$G"
  tar xzvf "$G"
  rm "$G"

  echo
  echo "Compile Gawk-5.1.0..."
  echo

  cd "gawk-5.1.0"

  ./configure && make && make check

  mv gawk ../gawk51

  cd ..
  ./gawk51 --version
  rm -r "gawk-5.1.0"

@goal std.awk
@doc 'generates std.awk file used for documentation (Ctrl-Q)'
@depends_on std.awk_clean
@depends_on std.awk_numeric
@depends_on std.awk_string
@depends_on std.awk_io
@depends_on std.awk_time
@depends_on std.awk_bitwise
@depends_on std.awk_type
@depends_on std.awk_i18n

@goal temp_folder_created @private
@reached_if [[ -d temp ]]
  mkdir temp

@goal string_functions_downloaded @private
@depends_on temp_folder_created
@reached_if [[ -f 'temp/String-Functions.html' ]]
  curl https://www.gnu.org/software/gawk/manual/html_node/String-Functions.html -o temp/String-Functions.html

@goal numeric_functions_downloaded @private
@depends_on temp_folder_created
@reached_if [[ -f 'temp/Numeric-Functions.html' ]]
  curl https://www.gnu.org/software/gawk/manual/html_node/Numeric-Functions.html -o temp/Numeric-Functions.html

@goal io_functions_downloaded @private
@depends_on temp_folder_created
@reached_if [[ -f 'temp/IO-Functions.html' ]]
  curl https://www.gnu.org/software/gawk/manual/html_node/I_002fO-Functions.html -o temp/IO-Functions.html

@goal time_functions_downloaded @private
@depends_on temp_folder_created
@reached_if [[ -f 'temp/Time-Functions.html' ]]
  curl https://www.gnu.org/software/gawk/manual/html_node/Time-Functions.html -o temp/Time-Functions.html

@goal bitwise_functions_downloaded @private
@depends_on temp_folder_created
@reached_if [[ -f 'temp/Bitwise-Functions.html' ]]
  curl https://www.gnu.org/software/gawk/manual/html_node/Bitwise-Functions.html -o temp/Bitwise-Functions.html

@goal type_functions_downloaded @private
@depends_on temp_folder_created
@reached_if [[ -f 'temp/Type-Functions.html' ]]
  curl https://www.gnu.org/software/gawk/manual/html_node/Type-Functions.html -o temp/Type-Functions.html

@goal i18n_functions_downloaded @private
@depends_on temp_folder_created
@reached_if [[ -f 'temp/I18N-Functions.html' ]]
  curl https://www.gnu.org/software/gawk/manual/html_node/I18N-Functions.html -o temp/I18N-Functions.html

@goal sprintf1_downloaded @private
@depends_on temp_folder_created
@reached_if [[ -f 'temp/Control-Letters.html' ]]
  curl https://www.gnu.org/software/gawk/manual/html_node/Control-Letters.html -o temp/Control-Letters.html

@goal sprintf2_downloaded @private
@depends_on temp_folder_created
@reached_if [[ -f 'temp/Format-Modifiers.html' ]]
  curl https://www.gnu.org/software/gawk/manual/html_node/Format-Modifiers.html -o temp/Format-Modifiers.html

@goal std.awk_clean @private
  echo > src/main/resources/std.awk

@goal std.awk_numeric @private
@depends_on numeric_functions_downloaded
  awk -f gen_std.awk temp/Numeric-Functions.html >> src/main/resources/std.awk

@goal std.awk_string @private
@depends_on string_functions_downloaded
@depends_on sprintf1_downloaded
@depends_on sprintf2_downloaded
  awk -f gen_std.awk temp/String-Functions.html >> src/main/resources/std.awk

@goal std.awk_io @private
@depends_on io_functions_downloaded
  awk -f gen_std.awk temp/IO-Functions.html >> src/main/resources/std.awk

@goal std.awk_time @private
@depends_on time_functions_downloaded
  awk -f gen_std.awk temp/Time-Functions.html >> src/main/resources/std.awk

@goal std.awk_bitwise @private
@depends_on bitwise_functions_downloaded
  awk -f gen_std.awk temp/Bitwise-Functions.html >> src/main/resources/std.awk

@goal std.awk_type @private
@depends_on type_functions_downloaded
  awk -f gen_std.awk temp/Type-Functions.html >> src/main/resources/std.awk

@goal std.awk_i18n @private
@depends_on i18n_functions_downloaded
  awk -f gen_std.awk temp/I18N-Functions.html >> src/main/resources/std.awk

